<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>Spring+shiro+mybatis+lombok项目部署</title><meta name="description" content="编程"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="项目介绍本项目是maven项目
数据库mysql
前端html+jquery+md5+wangEditor+cancas 框架:bootstrap
后端spring+mybatis+shiro+lombok
笔记配套项目:
配置文件spring:
  datasource:
    url: jdbc:mysql://localhost:3306/finance?useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;useSSL=false&amp;amp;serverTimezone=UTC&amp;amp;zeroDateTimeBehavior=convertToNull
    username: root
    password: 123456
    driver-cl.."><meta name="generator" content="Hexo 5.1.1">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">天明's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Spring+shiro+mybatis+lombok项目部署</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-text">项目介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E7%B1%BBJsonUtils"><span class="toc-text">返回类JsonUtils</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Config"><span class="toc-text">Config</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Spring"><i class="tag post-item-tag">Spring</i></a><a href="/tags/shiro"><i class="tag post-item-tag">shiro</i></a><a href="/tags/mybatis"><i class="tag post-item-tag">mybatis</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Spring+shiro+mybatis+lombok项目部署</h1><time class="has-text-grey" datetime="2024-01-25T12:07:51.000Z">2024-01-25</time><article class="mt-2 post-content"><h1 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h1><p>本项目是maven项目</p>
<p>数据库mysql</p>
<p>前端html+jquery+md5+wangEditor+cancas 框架:bootstrap</p>
<p>后端spring+mybatis+shiro+lombok</p>
<p>笔记配套项目:</p>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><pre><code class="yaml">spring:
  datasource:
    url: jdbc:mysql://localhost:3306/finance?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;zeroDateTimeBehavior=convertToNull
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1 FROM DUAL
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      filters: stat,wall
      use-global-data-source-stat: true
      connect-properties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000
  web:
    resources:
      static-locations: classpath:/static/

mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.crazy.finance.bean
  configuration:
    map-underscore-to-camel-case: true #将下换线转成驼峰式
#  configuration:
#   log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
server:
  port: 8099
</code></pre>
<h1 id="返回类JsonUtils"><a href="#返回类JsonUtils" class="headerlink" title="返回类JsonUtils"></a>返回类JsonUtils</h1><p><strong>在tuils里的JsonUtils类</strong></p>
<pre><code class="java">package com.example.finance.utils;

import lombok.Data;

import java.util.HashMap;
import java.util.Map;

/**
 * 通用的返回类（封装json数据）
 *
 */
@Data
public class JsonUtils {
    // 状态码 100-成功 200-失败
    private int code;
    // 提示信息
    private String msg;

    // 用户要返回给浏览器的数据
    private Map&lt;String, Object&gt; extend = new HashMap();
    /**
     * 处理成功
     *
     * @return
     */
    public static JsonUtils success() {
        JsonUtils result = new JsonUtils();
        result.setCode(100);
        result.setMsg("处理成功！");
        return result;
    }

    /**
     * 处理失败
     *
     * @return
     */
    public static JsonUtils fail() {
        JsonUtils result = new JsonUtils();
        result.setCode(200);
        result.setMsg("处理失败！");
        return result;
    }

    public static JsonUtils failPs() {
        JsonUtils result = new JsonUtils();
        result.setCode(300);
        result.setMsg("处理失败！");
        return result;
    }
    public static JsonUtils failEx() {
        JsonUtils result = new JsonUtils();
        result.setCode(400);
        result.setMsg("处理失败！");
        return result;
    }
    public static JsonUtils failNu() {
        JsonUtils result = new JsonUtils();
        result.setCode(500);
        result.setMsg("处理失败！");
        return result;
    }

    /**
     * 添加要返回的json数据
     *
     * @param key
     * @param value
     * @return
     */
    public JsonUtils add(String key, Object value) {
        this.getExtend().put(key, value);
        return this;
    }
}
</code></pre>
<h1 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h1><p>一些配置类</p>
<p>分别是ShiroConfig类</p>
<p>用来自动实现权限分配</p>
<pre><code class="java">package com.example.finance.config.shiro;

import at.pollux.thymeleaf.shiro.dialect.ShiroDialect;
import lombok.extern.slf4j.Slf4j;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;


import java.util.LinkedHashMap;
import java.util.Map;

@Slf4j
@Configuration
public class ShiroConfig {

   @Bean
   public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Qualifier("securityManager") DefaultWebSecurityManager securityManager){
       ShiroFilterFactoryBean bean = new ShiroFilterFactoryBean();
       bean.setSecurityManager(securityManager);
       //一定要用LinkedHashMap。不然会导致规则混乱
       Map&lt;String, String&gt; filterMap = new LinkedHashMap();
        // log.info("ShiroFilterFactoryBean-------------------------------");
       //添加shiro的内置过滤器
        /*
            anon: 无需认证就可访问
            authc：必须认证才能访问
            user：必须拥有记住我功能才能访问
            perms: 拥有对某个资源的权限才能访问
            role:拥有某个角色权限才能访问
       */
//     添加授权
      // filterMap.put("/user/**", "roles[user]");
      // filterMap.put("/admin/**", "roles[admin]");

//     过滤请求
       filterMap.put("/error/**", "anon");
       filterMap.put("/", "anon");
       filterMap.put("/index.html", "anon");
       filterMap.put("/toregister.html", "anon");
       filterMap.put("/login/**", "anon");
       filterMap.put("/asserts/**", "anon");
       filterMap.put("/bootstrap/**", "anon");
       filterMap.put("/images/**", "anon");
       filterMap.put("/lyear/**", "anon");
       filterMap.put("/js/**", "anon");
//     对所有请求认证
//     主要这行代码必须放在所有权限设置的最后，不然会导致所有 url 都被拦截
       filterMap.put("/**", "authc");

//      设置登出
//     filterMap.put("/logout", "logout");

       bean.setFilterChainDefinitionMap(filterMap);
//     设置登录请求（认证界面）
       bean.setLoginUrl("/");
//     设置未授权页面
//     bean.setUnauthorizedUrl("/noauth");

       return bean;
   }

    @Bean("securityManager")
    public DefaultWebSecurityManager getDefaultWebSecurityManager(@Qualifier("userRealm") UserRealm userRealm) {
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();

        securityManager.setRealm(userRealm);
        return securityManager;
    }

    @Bean("userRealm")
    public UserRealm getUserRealm() {
        return new UserRealm();
    }

    //整合thymeleaf
    @Bean
    public ShiroDialect getShiroDialect() {
        return new ShiroDialect();
    }

}
</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2024/02/04/obs%E6%8F%92%E4%BB%B6/" title="obs插件"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: obs插件</span></a><a class="button is-default" href="/2024/01/25/%E8%87%AA%E5%8A%A8%E5%8C%96python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="自动化python学习笔记"><span class="has-text-weight-semibold">下一页: 自动化python学习笔记</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Blackcat-love"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> 天明 2024</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>